# 在线购物系统需求文档

## 1. 文档信息

* 项目名称：在线购物系统（Online Shopping System）
* 文档类型：用户需求文档
* 文档版本：V1.0
* 编写日期：2025-12-24
* 关联文档：Construction.md（项目构建文档）

---

## 2. 项目概述

### 2.1 项目背景

在线购物系统旨在为顾客提供完整的在线购物体验，同时为管理员提供便捷的销售管理功能。系统需要支持顾客从商品浏览、购物车管理、下单支付到订单跟踪的全流程，以及管理员对商品、订单、销售数据的全面管理。

### 2.2 用户角色

**顾客（Customer）**
- 浏览和搜索商品
- 管理购物车
- 下单和支付
- 查看订单状态和历史
- 管理个人信息和收货地址

**管理员（Admin）**
- 管理商品信息（增删改查、上下架）
- 管理订单（查看、发货、取消、退款）
- 查看销售统计报表

---

## 3. 模块分析与需求

### 3.1 认证授权模块（auth）

#### 3.1.1 模块描述

认证授权模块负责用户注册、登录、注销以及权限验证，是整个系统的安全入口。

#### 3.1.2 用户需求

**顾客需求**
- **注册需求**：用户需要能够通过手机号或邮箱注册账户，设置密码和个人信息（昵称、收货地址等）
- **登录需求**：用户需要使用注册的账号和密码快速登录系统
- **注销需求**：用户需要能够安全退出登录状态
- **安全需求**：用户密码需要加密存储，避免泄露风险

**管理员需求**
- **管理员登录需求**：管理员需要使用管理员账号登录管理后台
- **权限控制需求**：确保只有管理员才能访问管理功能

#### 3.1.3 功能需求

1. **用户注册**
   - 支持手机号或邮箱注册
   - 密码强度验证（≥8位，包含字母和数字）
   - 邮箱格式校验
   - 手机号格式校验
   - 防止重复注册（邮箱/手机号唯一性校验）

2. **用户登录**
   - 账号密码登录
   - 登录成功后生成并返回 JWT Token
   - 支持 Token 验证和刷新机制

3. **用户注销**
   - 前端清除 Token
   - 后端可选提供 Token 黑名单机制

4. **权限验证**
   - 基于角色的权限控制（CUSTOMER/ADMIN）
   - API 接口级别的权限拦截
   - 管理端接口要求 ADMIN 角色

#### 3.1.4 非功能需求

- 密码使用 BCrypt 加密存储
- 使用 JWT（Access Token）进行身份认证
- 可选支持 Refresh Token 机制
- 基础限流防护（可选）

---

### 3.2 用户管理模块（user）

#### 3.2.1 模块描述

用户管理模块负责用户个人信息、收货地址等用户相关数据的管理。

#### 3.2.2 用户需求

**顾客需求**
- **个人信息管理需求**：用户需要能够查看和修改个人基本信息（昵称、头像等）
- **收货地址管理需求**：用户需要能够添加、编辑、删除多个收货地址，并设置默认地址
- **账户安全需求**：用户需要能够修改密码

#### 3.2.3 功能需求

1. **用户信息管理**
   - 查看个人基本信息
   - 修改昵称
   - 修改密码（需验证原密码）
   - 账户状态管理（正常/禁用）

2. **收货地址管理**
   - 添加收货地址（收件人姓名、电话、详细地址）
   - 编辑收货地址
   - 删除收货地址
   - 设置默认收货地址
   - 地址列表查询

#### 3.2.4 非功能需求

- 用户信息脱敏显示（管理员查看时）
- 地址数据完整性和格式校验

---

### 3.3 商品管理模块（product）

#### 3.3.1 模块描述

商品管理模块负责商品信息的管理和展示，包括商品列表、详情、分类、库存等。

#### 3.3.2 用户需求

**顾客需求**
- **商品浏览需求**：用户需要能够浏览所有在售商品，查看商品详细信息
- **商品搜索需求**：用户需要能够通过关键词搜索商品
- **商品筛选需求**：用户需要能够按分类、价格区间筛选商品
- **商品详情需求**：用户需要能够查看商品的详细描述、图片、价格、库存等信息

**管理员需求**
- **商品管理需求**：管理员需要能够添加、编辑、删除商品
- **商品上下架需求**：管理员需要能够控制商品是否对顾客可见
- **库存管理需求**：管理员需要能够查看和更新商品库存
- **分类管理需求**：管理员需要能够管理商品分类

#### 3.3.3 功能需求

1. **商品展示（顾客端）**
   - 商品列表分页显示（默认20条/页，最大100条/页）
   - 商品搜索（按商品名称、描述关键词）
   - 商品分类筛选
   - 价格区间筛选
   - 商品详情展示（名称、价格、库存、图片、描述、销量、上架状态）

2. **商品管理（管理端）**
   - 新增商品（名称、分类、价格、库存、描述、图片、上架状态）
   - 编辑商品（支持修改所有字段）
   - 删除商品（逻辑删除，避免影响历史订单）
   - 商品上下架操作
   - 商品列表查询和筛选

3. **商品分类管理（可选）**
   - 分类的增删改查
   - 分类层级管理

#### 3.3.4 非功能需求

- 商品列表分页性能优化
- 商品图片存储和加载优化
- 商品价格使用 DECIMAL 类型保证精度
- 库存数量实时显示，防止超卖

---

### 3.4 购物车模块（cart）

#### 3.4.1 模块描述

购物车模块负责用户购物车的管理，包括商品添加、数量修改、删除等操作。

#### 3.4.2 用户需求

- **添加商品需求**：用户需要能够将感兴趣的商品加入购物车
- **修改数量需求**：用户需要能够调整购物车中商品的数量
- **删除商品需求**：用户需要能够从购物车中移除不需要的商品
- **批量操作需求**：用户需要能够选择部分商品进行结算
- **清空购物车需求**：用户需要能够一键清空购物车

#### 3.4.3 功能需求

1. **购物车基本操作**
   - 添加商品到购物车
   - 修改购物车中商品数量
   - 删除购物车中的商品
   - 清空购物车
   - 查看购物车列表

2. **购物车结算准备**
   - 商品勾选/取消勾选
   - 计算选中商品的总价
   - 校验商品库存和上架状态（结算前）

#### 3.4.4 非功能需求

- 购物车数据与用户账户绑定
- 购物车商品数量限制（可选）
- 实时校验商品库存和价格

---

### 3.5 订单管理模块（order）

#### 3.5.1 模块描述

订单管理模块负责订单的创建、状态流转、查询等核心业务流程。

#### 3.5.2 用户需求

**顾客需求**
- **下单需求**：用户需要能够从购物车选择商品创建订单
- **订单查看需求**：用户需要能够查看所有订单列表和订单详情
- **订单状态查询需求**：用户需要能够实时了解订单状态（待支付、已支付、已发货、已完成等）
- **订单取消需求**：用户需要能够取消待支付的订单
- **订单历史需求**：用户需要能够查看历史订单记录

**管理员需求**
- **订单查询需求**：管理员需要能够按订单号、用户、状态、时间范围查询订单
- **订单处理需求**：管理员需要能够处理订单发货、取消、退款等操作
- **订单详情需求**：管理员需要能够查看订单完整信息和用户信息（脱敏）

#### 3.5.3 功能需求

1. **订单创建（顾客端）**
   - 从购物车勾选商品创建订单
   - 确认收货信息（收货人、电话、地址）
   - 确认商品信息和数量
   - 计算订单总价
   - 生成订单号（唯一业务单号）
   - 订单状态初始化为 CREATED（待支付）
   - 保存商品价格快照（避免价格变动影响）

2. **订单查询（顾客端）**
   - 订单列表分页查询
   - 按订单状态筛选（待支付/已支付/待发货/已发货/已完成/已取消/已退款）
   - 订单详情查询（订单号、下单时间、收货信息、商品明细、支付信息、状态流转记录）

3. **订单管理（管理端）**
   - 订单列表查询（支持多条件筛选）
   - 订单详情查看
   - 订单发货（录入物流信息，状态变更为 SHIPPED）
   - 订单取消
   - 订单退款处理（可选）

4. **订单状态流转**
   - CREATED（已创建/待支付）→ PAID（已支付/待发货）
   - CREATED → CANCELLED（用户取消或超时）
   - PAID → SHIPPED（管理员发货）
   - SHIPPED → COMPLETED（确认收货或自动完成）
   - PAID → REFUNDED（退款成功，可选）
   - 状态变更记录（记录变更时间、操作人、备注）

#### 3.5.4 非功能需求

- 订单状态流转严格遵循状态机规则
- 订单号唯一性保证
- 订单数据完整性（商品快照、价格快照）
- 订单创建时校验商品库存和上架状态
- 防超卖机制（支付成功时扣减库存，使用乐观锁或原子操作）

---

### 3.6 支付模块（payment）

#### 3.6.1 模块描述

支付模块负责处理订单支付相关业务，包括支付记录、支付状态管理等。

#### 3.6.2 用户需求

- **支付需求**：用户需要能够为订单完成支付操作
- **支付方式需求**：用户需要能够选择支付方式（初期支持模拟支付，后续可扩展真实支付）
- **支付结果查询需求**：用户需要能够查看支付状态和支付记录

#### 3.6.3 功能需求

1. **支付处理**
   - 模拟支付接口（初期实现）
   - 支付成功后更新订单状态为 PAID
   - 记录支付时间（paid_at）
   - 生成支付记录（payment_record）

2. **支付记录管理**
   - 支付记录创建（订单ID、支付方式、支付状态、交易流水号）
   - 支付记录查询
   - 支付状态更新

3. **支付回调处理（可扩展）**
   - 第三方支付回调接口
   - 支付结果验证和处理

#### 3.6.4 非功能需求

- 支付记录与订单状态一致性保证
- 支付记录数据完整性（保存原始支付数据JSON，可选）
- 支付成功时扣减商品库存
- 支付回调安全性验证（签名验证等）

---

### 3.7 管理后台模块（admin）

#### 3.7.1 模块描述

管理后台模块为管理员提供商品管理、订单管理、销售统计等管理功能。

#### 3.7.2 用户需求

- **商品管理需求**：管理员需要能够全面管理商品信息
- **订单管理需求**：管理员需要能够处理订单的发货、取消、退款等操作
- **数据统计需求**：管理员需要能够查看销售数据统计，了解业务情况

#### 3.7.3 功能需求

1. **商品管理功能**
   - 商品CRUD操作（参考3.3商品管理模块）
   - 商品批量操作（批量上下架等）

2. **订单管理功能**
   - 订单查询和筛选（参考3.5订单管理模块）
   - 订单发货处理
   - 订单取消和退款处理

3. **销售统计报表功能**
   - 核心指标统计：订单量、销售额、客单价、支付转化率
   - 销售趋势分析：按天/周/月统计销售额和订单数（折线图）
   - 热销商品统计：TOP N 热销商品（柱状图）
   - 订单状态分布：各状态订单数量统计（饼图）
   - 时间范围筛选：支持自定义时间范围查询

#### 3.7.4 非功能需求

- 管理端接口需要 ADMIN 角色权限验证
- 报表数据查询性能优化（考虑数据量大的情况）
- 统计数据准确性保证

---

### 3.8 通知模块（notification）

#### 3.8.1 模块描述

通知模块负责向用户发送邮件通知，主要是订单发货通知。

#### 3.8.2 用户需求

- **发货通知需求**：用户在订单发货后需要收到邮件通知，了解订单状态和物流信息
- **订单状态通知需求**：用户希望及时了解订单状态变更（可选扩展）

#### 3.8.3 功能需求

1. **邮件发送功能**
   - 订单发货邮件通知
   - 邮件内容包含：订单号、商品摘要、发货时间、物流单号（如有）、查看订单链接
   - 邮件主题：您的订单已发货（订单号：xxxx）

2. **邮件配置管理**
   - SMTP 服务器配置（支持QQ邮箱、163、企业邮箱、SendGrid等）
   - 邮件模板管理（可选）

#### 3.8.4 非功能需求

- 邮件发送可靠性（同步发送或异步队列）
- 邮件发送失败重试机制（可选）
- SMTP 配置使用环境变量管理，避免硬编码敏感信息

---

## 4. 跨模块需求

### 4.1 数据一致性需求

- 订单创建时保存商品价格快照，确保订单金额不受后续价格变动影响
- 库存扣减与订单支付状态保持一致
- 订单状态流转严格按照状态机规则执行

### 4.2 安全性需求

- 所有用户输入进行参数校验（JSR303）
- SQL 注入防护（使用 ORM）
- API 接口鉴权（JWT Token）
- 基于角色的权限控制（Spring Security）
- 敏感信息加密存储（密码、支付信息等）
- 用户信息脱敏（管理员查看时）

### 4.3 性能需求

- 列表查询支持分页（默认20条/页，最大100条/页）
- 接口响应时间：一般接口 < 500ms（本地/测试环境）
- 商品列表、订单列表查询性能优化
- 图片资源加载优化

### 4.4 可用性需求

- 系统可用性：支持7×24小时运行
- 错误处理：友好的错误提示信息
- 操作反馈：关键操作提供成功/失败反馈
- 数据校验：前端和后端双重校验

### 4.5 可扩展性需求

- 支付方式可扩展（初期模拟支付，后续可接入真实支付渠道）
- 支持后续功能扩展：多地址管理、优惠券、满减、积分、物流对接等
- 架构支持从单体应用演进到微服务（如需要）

---

## 5. 接口需求

### 5.1 接口设计原则

- RESTful API 设计规范
- 统一的返回结构（code、message、data）
- 统一的错误码和错误信息
- 接口版本管理（可选）

### 5.2 接口认证需求

- 需要登录的接口：使用 `Authorization: Bearer <token>` 头部
- 管理端接口：要求 ADMIN 角色权限
- Token 过期处理和刷新机制

### 5.3 接口性能需求

- 支持分页的接口必须实现分页
- 响应数据量合理控制
- 支持接口缓存（可选）

---

## 6. 数据库需求

### 6.1 数据存储需求

- 使用 MySQL 数据库（InnoDB 引擎，utf8mb4 字符集）
- 主键使用 BIGINT 类型（自增或雪花ID）
- 价格、金额使用 DECIMAL 类型保证精度
- 时间字段统一使用 TIMESTAMP 或 DATETIME

### 6.2 数据完整性需求

- 外键约束（可选，或通过应用层保证）
- 唯一性约束（邮箱、手机号、订单号等）
- 非空约束
- 数据删除采用逻辑删除（避免影响历史数据）

### 6.3 数据安全需求

- 敏感数据加密存储（密码等）
- 定期数据备份（部署时考虑）
- 数据库连接安全（使用连接池、避免SQL注入）

---

## 7. 前端需求

### 7.1 用户体验需求

- 界面美观、现代化设计
- 响应式布局，支持多设备访问
- 操作流程简单直观
- 加载状态提示
- 错误信息友好提示

### 7.2 功能需求

- 顾客端：登录/注册、商品浏览、购物车、订单、个人中心
- 管理端：商品管理、订单管理、报表展示
- 路由权限控制（前端路由守卫）
- 状态管理（登录态、购物车状态）

### 7.3 技术需求

- 使用 Vue 框架
- 路由管理（Vue Router）
- 状态管理（Pinia/Vuex）
- HTTP 请求（Axios，统一拦截器处理 Token、错误处理）
- UI 框架：Element Plus 或 Ant Design Vue

---

## 8. 部署需求

### 8.1 部署环境需求

- 前端：静态资源托管（Nginx）
- 后端：Spring Boot Jar 部署（Docker 或直接运行）
- 数据库：MySQL（Docker 或云数据库）
- 反向代理：Nginx（前端静态资源 + 后端 API 代理）

### 8.2 配置管理需求

- 环境配置分离（开发、测试、生产）
- 敏感配置使用环境变量（数据库连接、JWT密钥、SMTP配置等）
- 配置文件版本管理

### 8.3 可访问性需求

- 支持域名访问
- 支持 HTTPS（Let's Encrypt 证书，可选但建议）
- 生产环境可公开访问

---

## 9. 测试需求

### 9.1 功能测试需求

- 核心业务流程测试覆盖
- 边界条件测试
- 异常情况测试
- 权限控制测试

### 9.2 接口测试需求

- 接口功能测试
- 接口性能测试
- 接口安全性测试（权限、参数校验等）

### 9.3 测试工具需求

- API 测试工具：Postman/Apifox
- 自动化测试：Spring Boot Test + MockMvc（可选）

---

## 10. 后续扩展需求（预留）

### 10.1 功能扩展

- 多地址管理
- 优惠券系统
- 满减活动
- 积分系统
- 真实支付渠道对接
- 物流系统对接
- 商品评价和评分
- 商品推荐算法

### 10.2 技术扩展

- 搜索优化（Elasticsearch）
- 高并发优化（Redis 缓存、消息队列）
- 秒杀功能支持
- 审计日志和操作日志
- 风控系统

---

## 11. 需求优先级

### 11.1 高优先级（MVP核心功能）

1. 用户注册、登录、注销
2. 商品浏览和搜索
3. 购物车管理
4. 订单创建和支付（模拟）
5. 订单查询和状态查看
6. 商品管理（CRUD）
7. 订单管理（发货、取消）
8. 基础销售统计

### 11.2 中优先级（重要功能）

1. 邮件通知（发货通知）
2. 商品分类管理
3. 收货地址管理
4. 订单状态流转记录
5. 详细的销售报表

### 11.3 低优先级（可选功能）

1. 订单退款功能
2. 高级搜索和筛选
3. 商品图片多图管理
4. 支付回调处理
5. 其他扩展功能

---

## 12. 需求变更管理

- 需求变更需要经过评审
- 需求文档版本管理
- 需求变更影响分析
- 与 Construction.md 文档保持同步更新

